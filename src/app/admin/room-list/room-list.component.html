<div dir="rtl" class="p-4">
  <div class="flex justify-between items-center mb-4">
    <div class="flex items-center space-x-4 space-x-reverse">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange($event)"
        placeholder="ابحث عن اسم الغرفة..."
        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      @if (searchQuery()) {
      <button
        (click)="clearSearch()"
        class="px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
      >
        إلغاء
      </button>
      }
    </div>
    <div class="flex space-x-4 space-x-reverse">
      <button
        (click)="toggleShowDeleted()"
        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
      >
        {{ showDeleted() ? "عرض الغرف النشطة" : "عرض الغرف المحذوفة" }}
      </button>
      @if (!showDeleted()) {
      <button
        (click)="openModal('add')"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
      >
        إضافة غرفة جديدة
      </button>
      }
    </div>
  </div>

  @if (storeName()) {
  <h2 class="text-xl font-semibold mb-4">غرف متجر: {{ storeName() }}</h2>
  } @else {
  <p class="text-gray-500 mb-4">جارٍ تحميل اسم المتجر...</p>
  } @if (filteredRooms().length === 0) {
  <div class="text-center text-gray-500">
    لا توجد غرف {{ showDeleted() ? "محذوفة" : "" }}
  </div>
  } @else {
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    @for (room of filteredRooms(); track room.id) {
    <div class="bg-white border shadow-sm rounded-lg p-4">
      <h3 class="text-lg font-semibold">{{ room.username }}</h3>
      <p class="text-gray-600">كلمة المرور: {{ room.password }}</p>
      <div class="flex justify-end space-x-2 space-x-reverse mt-4">
        @if (!showDeleted()) {
        <button
          (click)="openModal('edit', room.id)"
          class="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
        >
          تعديل
        </button>
        <button
          (click)="openModal('delete', room.id)"
          class="px-3 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600"
        >
          حذف
        </button>
        } @else {
        <button
          (click)="openModal('restore', room.id)"
          class="px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600"
        >
          استعادة
        </button>
        }
      </div>
    </div>
    }
  </div>
  }

  <!-- Modal for Add/Edit -->
  @if (showModal() && (modalAction() === 'add' || modalAction() === 'edit')) {
  <div
    class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"
  >
    <div class="bg-white rounded-lg p-6 shadow-lg max-w-sm w-full">
      <h3 class="text-lg font-semibold mb-4">
        {{ modalAction() === "add" ? "إضافة غرفة جديدة" : "تعديل الغرفة" }}
      </h3>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">اسم الغرفة</label>
        <input
          type="text"
          [(ngModel)]="newRoom().username"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">كلمة المرور</label>
        <input
          type="password"
          [(ngModel)]="newRoom().password"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        @if (modalError()) {
        <p class="text-red-500 text-sm mt-1">{{ modalError() }}</p>
        }
      </div>
      <div class="flex justify-end space-x-2 space-x-reverse">
        <button
          (click)="closeModal()"
          class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
        >
          إلغاء
        </button>
        <button
          (click)="saveRoom()"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
        >
          حفظ
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Modal for Delete/Restore -->
  @if (showModal() && (modalAction() === 'delete' || modalAction() ===
  'restore')) {
  <div
    class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"
  >
    <div class="bg-white rounded-lg p-6 shadow-lg max-w-sm w-full">
      <h3 class="text-lg font-semibold mb-4">
        {{ modalAction() === "delete" ? "تأكيد الحذف" : "تأكيد الاستعادة" }}
      </h3>
      <p class="mb-4">
        هل أنت متأكد أنك تريد
        {{
          modalAction() === "delete" ? "حذف هذه الغرفة؟" : "استعادة هذه الغرفة؟"
        }}
      </p>
      <div class="flex justify-end space-x-2 space-x-reverse">
        <button
          (click)="closeModal()"
          class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
        >
          إلغاء
        </button>
        <button
          (click)="confirmAction()"
          class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
        >
          تأكيد
        </button>
      </div>
    </div>
  </div>
  }
</div>
