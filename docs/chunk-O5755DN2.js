import{a as m}from"./chunk-JYUIP5AP.js";import{a as u}from"./chunk-4UGSAFNV.js";import{l as h}from"./chunk-VSNPEVEX.js";import{H as n,Ra as c,ba as o,vb as a,za as r}from"./chunk-HYLWAQAG.js";var b=(()=>{class e{constructor(t,i,s){this.notificationService=t,this.authService=i,this.toastr=s,this.statusSubscription=null,this.currentRoomId=null,this.audio=new Audio("assets/mixkit-happy-bells-notification-937.wav")}ngOnInit(){this.authService.isLoggedIn()&&this.authService.getRoomId()&&(this.currentRoomId=this.authService.getRoomId(),this.startConnection())}startConnection(){this.notificationService.startRoomConnection().subscribe({next:()=>{this.subscribeToStatusUpdates()},error:t=>{console.error("Failed to start room connection:",t,"Connection State:",this.notificationService.getConnectionState()),setTimeout(()=>this.startConnection(),5e3)}})}subscribeToStatusUpdates(){this.statusSubscription&&this.statusSubscription.unsubscribe(),this.statusSubscription=this.notificationService.statusUpdate$.subscribe(t=>{t&&String(t.roomId)===String(this.currentRoomId)&&(t.message.includes("\u062A\u0645 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629")?(this.toastr.success(t.message,"\u0646\u062C\u0627\u062D",{disableTimeOut:!0,tapToDismiss:!0}),this.audio.play()):(this.toastr.error(t.message,"\u062E\u0637\u0623",{disableTimeOut:!0,tapToDismiss:!0}),this.audio.play()))})}ngOnDestroy(){this.notificationService.stopConnection(),this.statusSubscription&&this.statusSubscription.unsubscribe(),this.audio.pause(),this.audio.currentTime=0}static{this.\u0275fac=function(i){return new(i||e)(o(m),o(u),o(h))}}static{this.\u0275cmp=n({type:e,selectors:[["app-room-layout"]],standalone:!0,features:[c],decls:1,vars:0,template:function(i,s){i&1&&r(0,"router-outlet")},dependencies:[a]})}}return e})();export{b as RoomLayoutComponent};
