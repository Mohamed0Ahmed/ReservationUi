import{B as d,Bb as m,E as h,h as u,nb as g,wb as c,y as l}from"./chunk-HYLWAQAG.js";var b=(()=>{class n{constructor(o,t){this.http=o,this.router=t,this.apiUrl=m.apiUrl,this.isLoggedInSubject=new u(this.hasToken()),this.isLoggedIn$=this.isLoggedInSubject.asObservable(),this.userRole=null,this.storeId=null,this.roomId=null;let e=localStorage.getItem("token");if(e){let{role:s,storeId:r,roomId:i}=this.getRoleAndStoreIdFromToken(e);this.userRole=s,this.storeId=r,this.roomId=i,this.isLoggedInSubject.next(!0),this.redirectBasedOnRole()}}roomLogin(o,t,e){let s={storeName:o,userName:t,password:e};return this.http.post(`${this.apiUrl}/auth/room/login`,s).pipe(l(r=>{if(r.isSuccess&&r.data){let i=r.data.token;localStorage.setItem("token",i);let{role:a,storeId:I,roomId:p}=this.getRoleAndStoreIdFromToken(i);this.userRole=a,this.storeId=I,this.roomId=p,this.isLoggedInSubject.next(!0),this.router.navigate(["/room"])}}))}login(o,t){return this.http.post(`${this.apiUrl}/auth/login`,{email:o,password:t}).pipe(l(e=>{if(e.isSuccess&&e.message){let s=e.message;localStorage.setItem("token",s);let{role:r,storeId:i,roomId:a}=this.getRoleAndStoreIdFromToken(s);this.userRole=r,this.storeId=i,this.roomId=a,this.isLoggedInSubject.next(!0),this.userRole==="Admin"?this.router.navigate(["/admin"]):this.userRole==="Owner"?this.router.navigate(["/owner"]):this.router.navigate(["/login"])}}))}register(o,t){return this.http.post(`${this.apiUrl}/auth/register`,{email:o,password:t}).pipe(l(e=>{e.isSuccess?(console.log("\u062A\u0645 \u0627\u0644\u062A\u0633\u062C\u064A\u0644 \u0628\u0646\u062C\u0627\u062D"),this.router.navigate(["/login"])):console.warn("\u0641\u0634\u0644 \u0627\u0644\u062A\u0633\u062C\u064A\u0644:",e.message)}))}isLoggedIn(){return this.hasToken()}getRole(){return this.userRole}redirectBasedOnRole(){this.router.url==="/login"&&(this.userRole==="Admin"?this.router.navigate(["/admin"]):this.userRole==="Owner"?this.router.navigate(["/owner"]):this.router.navigate(["/login"]))}getStoreId(){return this.storeId}getRoomId(){return this.roomId}logout(){localStorage.removeItem("token"),this.userRole=null,this.storeId=null,this.roomId=null,this.isLoggedInSubject.next(!1),this.router.navigate(["/login"])}hasToken(){return!!localStorage.getItem("token")}getRoleAndStoreIdFromToken(o){try{let t=JSON.parse(atob(o.split(".")[1])),e=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||null,s=t.storeId||null,r=t.roomId||null;return{role:e,storeId:s,roomId:r}}catch{return{role:null,storeId:null,roomId:null}}}static{this.\u0275fac=function(t){return new(t||n)(h(g),h(c))}}static{this.\u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{b as a};
