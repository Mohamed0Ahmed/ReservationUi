import{a as v}from"./chunk-4UGSAFNV.js";import{l as q}from"./chunk-VSNPEVEX.js";import{a as $,c as N,e as j,g as P,n as U}from"./chunk-NMPAONDN.js";import{B as M,Bb as V,Ca as x,E as S,Ea as c,Fa as a,H as k,Ja as u,Ka as y,La as b,O as m,P as p,Ra as D,aa as l,ba as G,ja as h,k as F,la as g,lb as T,na as w,nb as E,ta as f,va as A,wa as I,xa as s,ya as r}from"./chunk-HYLWAQAG.js";var R=(()=>{class e{constructor(t,n){this.http=t,this.authService=n,this.apiUrl=V.apiUrl+"/gifts"}getStoreId(){return this.authService.getStoreId()}getAllGifts(){let t=this.getStoreId();return t?this.http.get(`${this.apiUrl}/store/${t}`):F(()=>new Error("Store ID not found"))}getAllDeletedGifts(){let t=this.getStoreId();return this.http.get(`${this.apiUrl}/store/deleted/${t}`)}createGift(t,n){let i=this.getStoreId();return this.http.post(this.apiUrl,{Name:t,PointsRequired:n,StoreId:parseInt(i)})}updateGift(t,n,i){return this.http.put(this.apiUrl,{Id:t,Name:n,PointsRequired:i,StoreId:parseInt(this.getStoreId())})}deleteGift(t){return this.http.delete(`${this.apiUrl}/${t}`)}restoreGift(t){return this.http.put(`${this.apiUrl}/restore/${t}`,null)}getTotalGiftsCount(){let t=this.getStoreId();return this.http.get(`${this.apiUrl}/count/${t}`)}static{this.\u0275fac=function(n){return new(n||e)(S(E),S(v))}}static{this.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var L=(e,d)=>d.id;function J(e,d){if(e&1){let t=x();s(0,"div",7)(1,"h3",9),u(2),r(),s(3,"p",10),u(4),r(),s(5,"div",11)(6,"button",12),c("click",function(){let i=m(t).$implicit,o=a(2);return p(o.openModal("edit",i.id))}),u(7," \u062A\u0639\u062F\u064A\u0644 "),r(),s(8,"button",13),c("click",function(){let i=m(t).$implicit,o=a(2);return p(o.openModal("delete",i.id))}),u(9," \u062D\u0630\u0641 "),r()()()}if(e&2){let t=d.$implicit;l(2),y(t.name),l(2),b(" ",t.pointsRequired," \u0646\u0642\u0637\u0629 ")}}function K(e,d){e&1&&(s(0,"div",8),u(1,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0647\u062F\u0627\u064A\u0627 \u0646\u0634\u0637\u0629"),r())}function O(e,d){if(e&1&&(A(0,J,10,2,"div",7,L),g(2,K,2,0,"div",8)),e&2){let t=a();I(t.gifts()),l(2),f(2,t.gifts().length?-1:2)}}function Q(e,d){if(e&1){let t=x();s(0,"div",7)(1,"h3",9),u(2),r(),s(3,"p",10),u(4),r(),s(5,"div",11)(6,"button",12),c("click",function(){let i=m(t).$implicit,o=a(2);return p(o.openModal("edit",i.id))}),u(7," \u062A\u0639\u062F\u064A\u0644 "),r(),s(8,"button",14),c("click",function(){let i=m(t).$implicit,o=a(2);return p(o.openModal("restore",i.id))}),u(9," \u0627\u0633\u062A\u0639\u0627\u062F\u0629 "),r()()()}if(e&2){let t=d.$implicit;l(2),y(t.name),l(2),b(" ",t.pointsRequired," \u0646\u0642\u0637\u0629 ")}}function W(e,d){e&1&&(s(0,"div",8),u(1,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0647\u062F\u0627\u064A\u0627 \u0645\u062D\u0630\u0648\u0641\u0629"),r())}function X(e,d){if(e&1&&(A(0,Q,10,2,"div",7,L),g(2,W,2,0,"div",8)),e&2){let t=a();I(t.deletedGifts()),l(2),f(2,t.deletedGifts().length?-1:2)}}function Y(e,d){if(e&1){let t=x();s(0,"div",20)(1,"input",21),c("ngModelChange",function(i){m(t);let o=a(2);return p(o.newGiftName.set(i))}),r()(),s(2,"div",20)(3,"input",22),c("ngModelChange",function(i){m(t);let o=a(2);return p(o.newGiftPoints.set(i))}),r()()}if(e&2){let t=a(2);l(),w("ngModel",t.newGiftName()),l(2),w("ngModel",t.newGiftPoints())}}function Z(e,d){e&1&&(s(0,"p",17),u(1,"\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0627\u0644\u0647\u062F\u064A\u0629\u061F"),r())}function tt(e,d){e&1&&(s(0,"p",17),u(1,"\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u0627\u0633\u062A\u0639\u0627\u062F\u0629 \u0627\u0644\u0647\u062F\u064A\u0629\u061F"),r())}function et(e,d){if(e&1){let t=x();s(0,"button",23),c("click",function(){m(t);let i=a(2);return p(i.saveGift())}),u(1," \u062D\u0641\u0638 "),r()}}function it(e,d){if(e&1){let t=x();s(0,"button",24),c("click",function(){m(t);let i=a(2);return p(i.confirmAction())}),u(1," \u062A\u0623\u0643\u064A\u062F "),r()}}function nt(e,d){if(e&1){let t=x();s(0,"div",6)(1,"div",15)(2,"h2",16),u(3),r(),g(4,Y,4,2)(5,Z,2,0,"p",17)(6,tt,2,0,"p",17),s(7,"div",11)(8,"button",3),c("click",function(){m(t);let i=a();return p(i.closeModal())}),u(9," \u0625\u0644\u063A\u0627\u0621 "),r(),g(10,et,2,0,"button",18)(11,it,2,0,"button",19),r()()()}if(e&2){let t=a();l(3),b(" ",t.modalAction()==="add"?"\u0625\u0636\u0627\u0641\u0629":t.modalAction()==="edit"?"\u062A\u0639\u062F\u064A\u0644":t.modalAction()==="delete"?"\u062A\u0623\u0643\u064A\u062F \u0627\u0644\u062D\u0630\u0641":"\u0627\u0633\u062A\u0639\u0627\u062F\u0629"," \u0647\u062F\u064A\u0629 "),l(),f(4,t.modalAction()!=="delete"&&t.modalAction()!=="restore"?4:-1),l(),f(5,t.modalAction()==="delete"?5:-1),l(),f(6,t.modalAction()==="restore"?6:-1),l(4),f(10,t.modalAction()!=="delete"&&t.modalAction()!=="restore"?10:-1),l(),f(11,t.modalAction()==="delete"||t.modalAction()==="restore"?11:-1)}}var mt=(()=>{class e{constructor(t,n,i){this.giftService=t,this.toastr=n,this.authService=i,this.gifts=h([]),this.deletedGifts=h([]),this.showDeleted=h(!1),this.showModal=h(!1),this.modalAction=h("add"),this.selectedGiftId=h(null),this.newGiftName=h(""),this.newGiftPoints=h(null),this.storeId=h(null),this.storeId.set(parseInt(this.authService.getStoreId()||"0")),this.loadGifts()}loadGifts(){if(!this.storeId()){this.toastr.error("\u0645\u0639\u0631\u0641 \u0627\u0644\u0645\u062A\u062C\u0631 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F");return}this.giftService.getAllGifts().subscribe({next:t=>{t.isSuccess&&t.data&&(this.gifts.set(t.data),console.log(t))},error:t=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0647\u062F\u0627\u064A\u0627")}})}loadDeletedGifts(){if(!this.storeId()){this.toastr.error("\u0645\u0639\u0631\u0641 \u0627\u0644\u0645\u062A\u062C\u0631 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F");return}this.giftService.getAllDeletedGifts().subscribe({next:t=>{t.isSuccess&&t.data&&this.deletedGifts.set(t.data)},error:t=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0647\u062F\u0627\u064A\u0627 \u0627\u0644\u0645\u062D\u0630\u0648\u0641\u0629")}})}toggleShowDeleted(){this.showDeleted.update(t=>!t),this.showDeleted()&&this.deletedGifts().length===0&&this.loadDeletedGifts()}openModal(t,n){if(this.modalAction.set(t),this.showModal.set(!0),this.selectedGiftId.set(n??null),t==="edit"&&n!=null){let o=(this.showDeleted()?this.deletedGifts():this.gifts()).find(_=>_.id===n);o&&(this.newGiftName.set(o.name),this.newGiftPoints.set(o.pointsRequired))}else this.newGiftName.set(""),this.newGiftPoints.set(null)}closeModal(){this.showModal.set(!1),this.newGiftName.set(""),this.newGiftPoints.set(null),this.selectedGiftId.set(null),this.modalAction.set("add")}saveGift(){let t=this.newGiftName(),n=this.newGiftPoints(),i=this.modalAction(),o=this.selectedGiftId();if(!t||n==null||n<0){this.toastr.error("\u064A\u0631\u062C\u0649 \u0625\u062F\u062E\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0647\u062F\u064A\u0629 \u0648\u0627\u0644\u0646\u0642\u0627\u0637 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629 (\u064A\u062C\u0628 \u0623\u0644\u0627 \u062A\u0643\u0648\u0646 \u0633\u0627\u0644\u0628\u0629)");return}if(!this.storeId()){this.toastr.error("\u0645\u0639\u0631\u0641 \u0627\u0644\u0645\u062A\u062C\u0631 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F");return}let _;if(i==="add")_=this.giftService.createGift(t,n);else if(i==="edit"&&o!=null)_=this.giftService.updateGift(o,t,n);else{this.closeModal();return}_.subscribe({next:C=>{C.isSuccess&&C.data?(this.loadGifts(),this.showDeleted()&&this.loadDeletedGifts(),this.toastr.success(C.message||"\u062A\u0645\u062A \u0627\u0644\u0639\u0645\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D"),this.closeModal()):this.toastr.error(C.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:C=>this.toastr.error(C.message||"\u062A\u062D\u0642\u0642 \u0645\u0646 \u0627\u0644\u0627\u0646\u062A\u0631\u0646\u062A \u0627\u0644\u062E\u0627\u0635 \u0628\u0643")})}confirmAction(){let t=this.modalAction(),n=this.selectedGiftId();if(!n){this.toastr.error("\u0645\u0639\u0631\u0641 \u0627\u0644\u0647\u062F\u064A\u0629 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F");return}let i;if(t==="delete")i=this.giftService.deleteGift(n);else if(t==="restore")i=this.giftService.restoreGift(n);else{this.closeModal();return}i.subscribe({next:o=>{o.isSuccess?(t==="restore"&&this.deletedGifts.set(this.deletedGifts().filter(_=>_.id!==n)),this.loadGifts(),this.loadDeletedGifts(),setTimeout(()=>{this.deletedGifts().length===0&&this.showDeleted()&&this.loadDeletedGifts()},0),this.toastr.success(o.message||"\u062A\u0645\u062A \u0627\u0644\u0639\u0645\u0644\u064A\u0629 \u0628\u0646\u062C\u0627\u062D"),this.closeModal()):this.toastr.error(o.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:o=>this.toastr.error(o.message||"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")})}static{this.\u0275fac=function(n){return new(n||e)(G(R),G(q),G(v))}}static{this.\u0275cmp=k({type:e,selectors:[["app-gift"]],standalone:!0,features:[D],decls:12,vars:5,consts:[["dir","rtl",1,"container","mx-auto","p-6","text-gray-400"],[1,"text-2xl","font-bold","text-white","mb-6"],[1,"mb-6","flex","items-center","gap-3"],[1,"px-4","py-2","bg-gray-600","text-white","rounded-lg","hover:bg-gray-700","transition",3,"click"],[1,"px-4","py-2","bg-green-500","text-white","rounded-lg","hover:bg-green-600","transition",3,"click","disabled"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","p-4"],[1,"w-full","border","border-gray-700","rounded-lg","shadow-sm","p-4"],[1,"text-center","text-gray-400","p-4"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-sm","text-gray-100","font-bold","mb-2"],[1,"flex","justify-end","space-x-2","space-x-reverse"],[1,"px-3","py-1","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","transition",3,"click"],[1,"px-3","py-1","bg-red-500","text-white","rounded-lg","hover:bg-red-600","transition",3,"click"],[1,"px-3","py-1","bg-green-500","text-white","rounded-lg","hover:bg-green-600","transition",3,"click"],[1,"bg-gray-800","p-6","rounded-lg","w-full","max-w-sm"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"mb-4","text-gray-400"],[1,"px-4","py-2","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","transition"],[1,"px-4","py-2","bg-red-500","text-white","rounded-lg","hover:bg-red-600","transition"],[1,"mb-4"],["placeholder","\u0627\u0633\u0645 \u0627\u0644\u0647\u062F\u064A\u0629",1,"w-full","px-3","py-2","border","border-gray-600","rounded-lg","bg-gray-700","text-white","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["type","number","placeholder","\u0627\u0644\u0646\u0642\u0627\u0637 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629",1,"w-full","px-3","py-2","border","border-gray-600","rounded-lg","bg-gray-700","text-white","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"px-4","py-2","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","transition",3,"click"],[1,"px-4","py-2","bg-red-500","text-white","rounded-lg","hover:bg-red-600","transition",3,"click"]],template:function(n,i){n&1&&(s(0,"div",0)(1,"h1",1),u(2,"\u0627\u0644\u0647\u062F\u0627\u064A\u0627"),r(),s(3,"div",2)(4,"button",3),c("click",function(){return i.toggleShowDeleted()}),u(5),r(),s(6,"button",4),c("click",function(){return i.openModal("add")}),u(7," \u0625\u0636\u0627\u0641\u0629 \u0647\u062F\u064A\u0629 "),r()(),s(8,"div",5),g(9,O,3,1)(10,X,3,1),r(),g(11,nt,12,6,"div",6),r()),n&2&&(l(5),b(" ",i.showDeleted()?"\u0639\u0631\u0636 \u0627\u0644\u0646\u0634\u0637":"\u0639\u0631\u0636 \u0627\u0644\u0645\u062D\u0630\u0648\u0641"," "),l(),w("disabled",!i.storeId()),l(3),f(9,i.showDeleted()?-1:9),l(),f(10,i.showDeleted()?10:-1),l(),f(11,i.showModal()?11:-1))},dependencies:[U,$,P,N,j,T]})}}return e})();export{mt as GiftComponent};
