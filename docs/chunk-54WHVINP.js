import{a as H}from"./chunk-JYUIP5AP.js";import{a as z,b as K,c as Q}from"./chunk-T4ISPZRZ.js";import{a as Z}from"./chunk-LFKNZO6Y.js";import{a as J}from"./chunk-7HQIZKG2.js";import{a as N}from"./chunk-4UGSAFNV.js";import{l as U}from"./chunk-VSNPEVEX.js";import{a as $,c as B,e as L,n as G}from"./chunk-NMPAONDN.js";import{Ca as y,Ea as _,Fa as d,H as j,Ja as r,Ka as S,La as c,Ma as k,O as x,P as v,Ra as q,Va as V,a as R,aa as o,b as F,ba as C,db as f,gb as M,ib as D,ja as p,la as b,lb as P,na as h,sa as w,ta as A,va as E,wa as T,xa as n,ya as s}from"./chunk-HYLWAQAG.js";var ee=(u,l,e)=>({"text-green-500":u,"text-red-500":l,"text-gray-500":e}),W=(u,l,e)=>({"text-green-500":u,"text-red-500":l,"text-gray-300":e});function te(u,l){if(u&1){let e=y();n(0,"button",23),_("click",function(){x(e);let t=d(2).$implicit,a=d(2);return v(a.approveOrder(t.id))}),r(1," \u0642\u0628\u0648\u0644 "),s(),n(2,"button",24),_("click",function(){x(e);let t=d(2).$implicit,a=d(2);return v(a.openModal("rejectOrder",t.id))}),r(3," \u0631\u0641\u0636 "),s()}}function ie(u,l){u&1&&(n(0,"span",20),r(1,"\u062A\u0645 \u0627\u0644\u062A\u0639\u0627\u0645\u0644 \u0645\u0639 \u0627\u0644\u0637\u0644\u0628"),s())}function ne(u,l){if(u&1&&(n(0,"dl",17)(1,"div",18)(2,"dt",19),r(3,"\u0627\u0633\u0645 \u0627\u0644\u063A\u0631\u0641\u0629:"),s(),n(4,"dd",20),r(5),s()(),n(6,"div",18)(7,"dt",19),r(8,"\u0631\u0642\u0645 \u0627\u0644\u0639\u0645\u064A\u0644:"),s(),n(9,"dd",20),r(10),s()(),n(11,"div",18)(12,"dt",19),r(13,"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0637\u0644\u0628:"),s(),n(14,"dd",20),r(15),s()(),n(16,"div",18)(17,"dt",19),r(18,"\u0627\u0644\u0645\u062C\u0645\u0648\u0639:"),s(),n(19,"dd",20),r(20),s()(),n(21,"div",18)(22,"dt",19),r(23,"\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636:"),s(),n(24,"dd",20),r(25),s()(),n(26,"div",18)(27,"dt",19),r(28,"\u0627\u0644\u062D\u0627\u0644\u0629:"),s(),n(29,"dd",21),r(30),s()()(),n(31,"div",22),b(32,te,4,0)(33,ie,2,0),s()),u&2){let e=d().$implicit,i=d(2);o(5),S(e.roomName||"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"),o(5),S(e.customerNumber),o(5),c(" ",i.convertToEgyptTime(e.orderDate)," "),o(5),c("",e.totalAmount," \u062C\u0646\u064A\u0647"),o(5),S(e.rejectionReason||"-"),o(4),h("ngClass",V(8,ee,e.status===1,e.status===2,e.status===0)),o(),c(" ",i.getStatusLabel(e.status)," "),o(2),A(32,e.status===0?32:33)}}function se(u,l){if(u&1&&(n(0,"div")(1,"div",26)(2,"dt",19),r(3),s(),n(4,"dd",27),r(5),s()()()),u&2){let e=l.$implicit,i=d(4);o(3),c(" ",i.getItemName(e.menuItemId)," "),o(2),S(e.quantity)}}function re(u,l){if(u&1&&(n(0,"dl",25),E(1,se,6,2,"div",null,w().trackByItem,!0),s()),u&2){let e=d().$implicit;o(),T(e.orderItems)}}function ue(u,l){if(u&1){let e=y();n(0,"div",12)(1,"div",14)(2,"button",15),_("click",function(){let t=x(e).$implicit,a=d(2);return v(a.setActiveTab(t.id,a.activeTab()[t.id]==="details"?"items":"details"))}),r(3),s()(),n(4,"div",16),b(5,ne,34,12)(6,re,3,0),s()()}if(u&2){let e=l.$implicit,i=d(2);o(2),h("ngClass",i.activeTab()[e.id]==="details"?"text-blue-500":"text-gray-400"),o(),c(" ",i.activeTab()[e.id]==="details"?"\u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u0637\u0644\u0628":"\u0627\u0644\u0623\u0635\u0646\u0627\u0641"," "),o(2),A(5,i.activeTab()[e.id]==="details"?5:6)}}function oe(u,l){if(u&1&&(n(0,"div",13),r(1),s()),u&2){let e=d(2);o(),c(" ",e.orderView()==="pendingOrders"?"\u0644\u0627 \u064A\u0648\u062C\u062F \u0637\u0644\u0628\u0627\u062A \u0645\u0639\u0644\u0642\u0629 \u062D\u0627\u0644\u064A\u0627\u064B":"\u0644\u0627 \u062A\u0648\u062C\u062F \u0637\u0644\u0628\u0627\u062A"," ")}}function ae(u,l){if(u&1&&(n(0,"div",11),E(1,ue,7,3,"div",12,w().trackByOrder,!0),b(3,oe,2,1,"div",13),s()),u&2){let e=d();o(),T(e.filteredOrders()),o(2),A(3,e.filteredOrders().length?-1:3)}}function de(u,l){if(u&1){let e=y();n(0,"button",23),_("click",function(){x(e);let t=d().$implicit,a=d(2);return v(a.approveAssistanceRequest(t.id))}),r(1," \u0642\u0628\u0648\u0644 "),s(),n(2,"button",24),_("click",function(){x(e);let t=d().$implicit,a=d(2);return v(a.openModal("rejectAssistance",t.id))}),r(3," \u0631\u0641\u0636 "),s()}}function le(u,l){u&1&&(n(0,"span",20),r(1,"\u062A\u0645 \u0627\u0644\u062A\u0639\u0627\u0645\u0644 \u0645\u0639 \u0627\u0644\u0637\u0644\u0628"),s())}function ce(u,l){if(u&1&&(n(0,"div",12)(1,"div",16)(2,"dl",17)(3,"div",18)(4,"dt",19),r(5,"\u0627\u0633\u0645 \u0627\u0644\u063A\u0631\u0641\u0629:"),s(),n(6,"dd",20),r(7),s()(),n(8,"div",18)(9,"dt",19),r(10,"\u0646\u0648\u0639 \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629:"),s(),n(11,"dd",28),r(12),s()(),n(13,"div",18)(14,"dt",19),r(15,"\u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0637\u0644\u0628:"),s(),n(16,"dd",20),r(17),s()(),n(18,"div",18)(19,"dt",19),r(20,"\u0627\u0644\u062D\u0627\u0644\u0629:"),s(),n(21,"dd",21),r(22),s()(),n(23,"div",18)(24,"dt",19),r(25,"\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636:"),s(),n(26,"dd",20),r(27),s()()(),n(28,"div",22),b(29,de,4,0)(30,le,2,0),s()()()),u&2){let e=l.$implicit,i=d(2);o(7),S(e.roomName||"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"),o(5),c(" ",i.getAssistanceTypeName(e.requestTypeId)," "),o(5),c(" ",i.convertToEgyptTime(e.requestDate)," "),o(4),h("ngClass",V(7,W,e.status===1,e.status===2,e.status===0)),o(),c(" ",i.getStatusLabel(e.status)," "),o(5),S(e.rejectionReason||"-"),o(2),A(29,e.status===0?29:30)}}function me(u,l){if(u&1&&(n(0,"div",13),r(1),s()),u&2){let e=d(2);o(),c(" ",e.assistanceView()==="pendingAssistance"?"\u0644\u0627 \u064A\u0648\u062C\u062F \u0637\u0644\u0628\u0627\u062A \u0645\u0633\u0627\u0639\u062F\u0629 \u0645\u0639\u0644\u0642\u0629 \u062D\u0627\u0644\u064A\u0627\u064B":"\u0644\u0627 \u062A\u0648\u062C\u062F \u0637\u0644\u0628\u0627\u062A \u0645\u0633\u0627\u0639\u062F\u0629"," ")}}function pe(u,l){if(u&1&&(n(0,"div",11),E(1,ce,31,11,"div",12,w().trackByRequest,!0),b(3,me,2,1,"div",13),s()),u&2){let e=d();o(),T(e.filteredAssistanceRequests()),o(2),A(3,e.filteredAssistanceRequests().length?-1:3)}}function _e(u,l){if(u&1){let e=y();n(0,"button",23),_("click",function(){x(e);let t=d().$implicit,a=d(2);return v(a.approveRedemption(t.id))}),r(1," \u0642\u0628\u0648\u0644 "),s(),n(2,"button",24),_("click",function(){x(e);let t=d().$implicit,a=d(2);return v(a.openModal("rejectRedemption",t.id))}),r(3," \u0631\u0641\u0636 "),s()}}function he(u,l){u&1&&(n(0,"span",20),r(1,"\u062A\u0645 \u0627\u0644\u062A\u0639\u0627\u0645\u0644 \u0645\u0639 \u0627\u0644\u0637\u0644\u0628"),s())}function ge(u,l){if(u&1&&(n(0,"div",12)(1,"div",16)(2,"dl",17)(3,"div",18)(4,"dt",19),r(5,"\u0627\u0633\u0645 \u0627\u0644\u063A\u0631\u0641\u0629:"),s(),n(6,"dd",20),r(7),s()(),n(8,"div",18)(9,"dt",19),r(10,"\u0627\u0633\u0645 \u0627\u0644\u0647\u062F\u064A\u0629:"),s(),n(11,"dd",28),r(12),s()(),n(13,"div",18)(14,"dt",19),r(15,"\u0631\u0642\u0645 \u0627\u0644\u0639\u0645\u064A\u0644:"),s(),n(16,"dd",20),r(17),s()(),n(18,"div",18)(19,"dt",19),r(20,"\u0627\u0644\u0646\u0642\u0627\u0637 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u0629:"),s(),n(21,"dd",20),r(22),s()(),n(23,"div",18)(24,"dt",19),r(25,"\u0627\u0644\u062D\u0627\u0644\u0629:"),s(),n(26,"dd",21),r(27),s()(),n(28,"div",18)(29,"dt",19),r(30,"\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636:"),s(),n(31,"dd",20),r(32),s()()(),n(33,"div",22),b(34,_e,4,0)(35,he,2,0),s()()()),u&2){let e=l.$implicit,i=d(2);o(7),c(" ",e.roomName||"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"," "),o(5),S(e.giftName),o(5),S(e.customerNumber),o(5),c("",e.pointsUsed," \u0646\u0642\u0637\u0629"),o(4),h("ngClass",V(8,W,e.status===1,e.status===2,e.status===0)),o(),c(" ",i.getStatusLabel(e.status)," "),o(5),c(" ",e.rejectionReason||"-"," "),o(2),A(34,e.status===0?34:35)}}function xe(u,l){if(u&1&&(n(0,"div",13),r(1),s()),u&2){let e=d(2);o(),c(" ",e.redemptionView()==="pendingRedemptions"?"\u0644\u0627 \u064A\u0648\u062C\u062F \u0637\u0644\u0628\u0627\u062A \u0627\u0633\u062A\u0628\u062F\u0627\u0644 \u0645\u0639\u0644\u0642\u0629 \u062D\u0627\u0644\u064A\u0627\u064B":"\u0644\u0627 \u062A\u0648\u062C\u062F \u0637\u0644\u0628\u0627\u062A \u0627\u0633\u062A\u0628\u062F\u0627\u0644"," ")}}function ve(u,l){if(u&1&&(n(0,"div",11),E(1,ge,36,12,"div",12,w().trackByRedemption,!0),b(3,xe,2,1,"div",13),s()),u&2){let e=d();o(),T(e.filteredRedemptions()),o(2),A(3,e.filteredRedemptions().length?-1:3)}}function fe(u,l){if(u&1){let e=y();n(0,"div",10)(1,"div",29)(2,"h2",30),r(3),s(),n(4,"div",31)(5,"input",32),_("ngModelChange",function(t){x(e);let a=d();return v(a.rejectionReason.set(t))}),s()(),n(6,"div",33)(7,"button",34),_("click",function(){x(e);let t=d();return v(t.closeModal())}),r(8," \u0625\u0644\u063A\u0627\u0621 "),s(),n(9,"button",35),_("click",function(){x(e);let t=d();return v(t.modalAction()==="rejectOrder"?t.rejectOrder():t.modalAction()==="rejectAssistance"?t.rejectAssistanceRequest():t.rejectRedemption())}),r(10," \u062A\u0623\u0643\u064A\u062F \u0627\u0644\u0631\u0641\u0636 "),s()()()()}if(u&2){let e=d();o(3),c(" ",e.modalAction()==="rejectOrder"?"\u0631\u0641\u0636 \u0627\u0644\u0637\u0644\u0628":e.modalAction()==="rejectAssistance"?"\u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629":"\u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644"," "),o(2),h("ngModel",e.rejectionReason())}}var Me=(()=>{class u{constructor(e,i,t,a,g,I,X,Y){this.orderService=e,this.menuService=i,this.assistanceService=t,this.requestService=a,this.giftRedemptionService=g,this.notificationService=I,this.authService=X,this.toastr=Y,this.orders=p([]),this.items=p([]),this.assistanceRequests=p([]),this.redemptions=p([]),this.assistanceTypes=p([]),this.showModal=p(!1),this.modalAction=p("rejectOrder"),this.selectedId=p(null),this.rejectionReason=p(""),this.storeId=p(null),this.currentFilter=p("orders"),this.orderView=p("pendingOrders"),this.assistanceView=p("pendingAssistance"),this.redemptionView=p("pendingRedemptions"),this.activeTab=p({}),this.filteredOrders=f(()=>{let m=this.orders();return this.orderView()==="pendingOrders"?m.filter(O=>O.status===0):m}),this.filteredAssistanceRequests=f(()=>{let m=this.assistanceRequests();return this.assistanceView()==="pendingAssistance"?m.filter(O=>O.status===0):m}),this.filteredRedemptions=f(()=>{let m=this.redemptions();return this.redemptionView()==="pendingRedemptions"?m.filter(O=>O.status===0):m}),this.totalOrders=f(()=>this.filteredOrders().length),this.totalAssistanceRequests=f(()=>this.filteredAssistanceRequests().length),this.totalRedemptions=f(()=>this.filteredRedemptions().length),this.pendingOrdersCount=f(()=>this.orders().filter(m=>m.status===0).length),this.pendingAssistanceCount=f(()=>this.assistanceRequests().filter(m=>m.status===0).length),this.pendingRedemptionsCount=f(()=>this.redemptions().filter(m=>m.status===0).length),this.subscription=null,this.storeId.set(parseInt(this.authService.getStoreId()||"0")),this.loadPendingOrders(),this.loadItems(),this.loadAssistanceTypes(),this.loadPendingAssistanceRequests(),this.loadPendingRedemptions(),this.subscription=this.notificationService.notification$.subscribe(m=>{m&&this.refreshData(m)})}setActiveTab(e,i){this.activeTab.update(t=>F(R({},t),{[e]:i}))}loadOrders(){this.storeId()&&this.orderService.getOrders(this.storeId()).subscribe({next:e=>{if(e.isSuccess&&e.data){this.orders.set(e.data.reverse());let i=R({},this.activeTab());e.data.forEach(t=>{i[t.id]||(i[t.id]="details")}),this.activeTab.set(i)}},error:()=>{this.toastr.error("\u062A\u062D\u0642\u0642 \u0645\u0646 \u0627\u0644\u0627\u0646\u062A\u0631\u0646\u062A \u0627\u0644\u062E\u0627\u0635 \u0628\u0643")}})}loadPendingOrders(){this.storeId()&&this.orderService.getPendingOrders(this.storeId()).subscribe({next:e=>{if(e.isSuccess&&e.data){this.orders.set(e.data);let i=R({},this.activeTab());e.data.forEach(t=>{i[t.id]||(i[t.id]="details")}),this.activeTab.set(i)}},error:()=>{}})}loadAssistanceRequests(){this.storeId()&&this.requestService.getAllAssistanceRequests(this.storeId()).subscribe({next:e=>{e.isSuccess&&e.data&&this.assistanceRequests.set(e.data.reverse())},error:()=>{}})}loadPendingAssistanceRequests(){this.storeId()&&this.requestService.getPendingAssistanceRequests(this.storeId()).subscribe({next:e=>{e.isSuccess&&e.data&&this.assistanceRequests.set(e.data)},error:()=>{}})}loadRedemptions(){this.storeId()&&this.giftRedemptionService.getAllRedemptions().subscribe({next:e=>{e.isSuccess&&e.data&&this.redemptions.set(e.data.reverse())},error:()=>{this.toastr.error("\u062A\u062D\u0642\u0642 \u0645\u0646 \u0627\u0644\u0627\u0646\u062A\u0631\u0646\u062A \u0627\u0644\u062E\u0627\u0635 \u0628\u0643")}})}loadPendingRedemptions(){this.storeId()&&this.giftRedemptionService.getPendingRedemptions().subscribe({next:e=>{console.log(e),e.isSuccess&&e.data&&this.redemptions.set(e.data)},error:()=>{}})}loadItems(){this.storeId()&&this.menuService.getAllItems(this.storeId()).subscribe({next:e=>{e.isSuccess&&e.data&&this.items.set(e.data)},error:()=>{}})}loadAssistanceTypes(){this.storeId()&&this.assistanceService.getAllAssistanceTypes(this.storeId()).subscribe({next:e=>{e.isSuccess&&e.data&&this.assistanceTypes.set(e.data)},error:()=>{}})}setFilter(e){this.currentFilter.set(e),e==="orders"?this.orderView()==="pendingOrders"?this.loadPendingOrders():this.loadOrders():e==="assistance"?this.assistanceView()==="pendingAssistance"?this.loadPendingAssistanceRequests():this.loadAssistanceRequests():this.redemptionView()==="pendingRedemptions"?this.loadPendingRedemptions():this.loadRedemptions()}toggleView(e){e==="pendingOrders"||e==="allOrders"?(this.orderView.set(e),e==="pendingOrders"?this.loadPendingOrders():this.loadOrders()):e==="pendingAssistance"||e==="allAssistance"?(this.assistanceView.set(e),e==="pendingAssistance"?this.loadPendingAssistanceRequests():this.loadAssistanceRequests()):(this.redemptionView.set(e),e==="pendingRedemptions"?this.loadPendingRedemptions():this.loadRedemptions())}refreshData(e){e.includes("\u0637\u0644\u0628 \u062C\u062F\u064A\u062F")&&this.currentFilter()==="orders"?this.orderView()==="pendingOrders"?this.loadPendingOrders():this.loadOrders():e.includes("\u0637\u0644\u0628 \u0645\u0633\u0627\u0639\u062F\u0629")&&this.currentFilter()==="assistance"?this.assistanceView()==="pendingAssistance"?this.loadPendingAssistanceRequests():this.loadAssistanceRequests():(e.includes("\u0637\u0644\u0628 \u0627\u0633\u062A\u0628\u062F\u0627\u0644")||e==="redemption_updated")&&this.currentFilter()==="redemptions"&&(this.redemptionView()==="pendingRedemptions"?this.loadPendingRedemptions():this.loadRedemptions())}openModal(e,i){this.modalAction.set(e),this.showModal.set(!0),this.selectedId.set(i),this.rejectionReason.set("")}closeModal(){this.showModal.set(!1),this.selectedId.set(null),this.rejectionReason.set(""),this.modalAction.set("rejectOrder")}approveOrder(e){this.selectedId.set(e),this.orderService.approveOrder(e).subscribe({next:i=>{i.isSuccess?(this.orders.update(a=>a.map(g=>g.id===e?F(R({},g),{status:1}):g)),this.pendingOrdersCount()===0&&this.loadPendingOrders(),this.toastr.success(i.message||"\u062A\u0645 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0627\u0644\u0637\u0644\u0628 \u0628\u0646\u062C\u0627\u062D")):this.toastr.error(i.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:()=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0627\u0644\u0637\u0644\u0628")}})}approveAssistanceRequest(e){this.selectedId.set(e),this.requestService.approveAssistanceRequest(e).subscribe({next:i=>{i.isSuccess?(this.assistanceRequests.update(a=>a.map(g=>g.id===e?F(R({},g),{status:1}):g)),this.pendingAssistanceCount()===0&&this.loadPendingAssistanceRequests(),this.toastr.success(i.message||"\u062A\u0645 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0637\u0644\u0628 \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629 \u0628\u0646\u062C\u0627\u062D")):this.toastr.error(i.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:()=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0637\u0644\u0628 \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629")}})}approveRedemption(e){this.selectedId.set(e);let i={isApproved:!0,rejectionReason:""};this.giftRedemptionService.updateRedemptionStatus(e,i).subscribe({next:t=>{t.isSuccess?(this.redemptions.update(g=>g.map(I=>I.id===e?F(R({},I),{status:1}):I)),this.pendingRedemptionsCount()===0&&this.loadPendingRedemptions(),this.toastr.success(t.message||"\u062A\u0645 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644 \u0628\u0646\u062C\u0627\u062D")):this.toastr.error(t.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:()=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0627\u0644\u0645\u0648\u0627\u0641\u0642\u0629 \u0639\u0644\u0649 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644")}})}rejectOrder(){let e=this.selectedId(),i={reason:this.rejectionReason()};if(!e||!i.reason){this.toastr.error("\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636 \u0645\u0637\u0644\u0648\u0628");return}this.orderService.rejectOrder(e,i).subscribe({next:t=>{t.isSuccess?(this.refreshData("\u0637\u0644\u0628 \u062C\u062F\u064A\u062F"),this.toastr.success(t.message||"\u062A\u0645 \u0631\u0641\u0636 \u0627\u0644\u0637\u0644\u0628 \u0628\u0646\u062C\u0627\u062D"),this.closeModal()):this.toastr.error(t.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:()=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0631\u0641\u0636 \u0627\u0644\u0637\u0644\u0628")}})}rejectAssistanceRequest(){let e=this.selectedId(),i={reason:this.rejectionReason()};if(!e||!i.reason){this.toastr.error("\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636 \u0645\u0637\u0644\u0648\u0628");return}this.requestService.rejectAssistanceRequest(e,i).subscribe({next:t=>{t.isSuccess?(this.refreshData("\u0637\u0644\u0628 \u0645\u0633\u0627\u0639\u062F\u0629"),this.toastr.success(t.message||"\u062A\u0645 \u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629 \u0628\u0646\u062C\u0627\u062D"),this.closeModal()):this.toastr.error(t.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:()=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629")}})}rejectRedemption(){let e=this.selectedId(),i=this.rejectionReason();if(!e||!i){this.toastr.error("\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636 \u0645\u0637\u0644\u0648\u0628");return}let t={isApproved:!1,rejectionReason:i};this.giftRedemptionService.updateRedemptionStatus(e,t).subscribe({next:a=>{a.isSuccess?(this.refreshData("redemption_updated"),this.toastr.success(a.message||"\u062A\u0645 \u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644 \u0628\u0646\u062C\u0627\u062D"),this.closeModal()):this.toastr.error(a.message||"\u0641\u0634\u0644 \u0627\u0644\u0639\u0645\u0644\u064A\u0629")},error:()=>{this.toastr.error("\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u0631\u0641\u0636 \u0637\u0644\u0628 \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644")}})}getStatusLabel(e){switch(e){case 0:return"\u0645\u0639\u0644\u0642";case 1:return"\u0645\u0642\u0628\u0648\u0644";case 2:return"\u0645\u0631\u0641\u0648\u0636";default:return"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"}}getItemName(e){let i=this.items().find(t=>t.id===e);return i?i.name:"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"}getAssistanceTypeName(e){let i=this.assistanceTypes().find(t=>t.id===e);return i?i.name:"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"}convertToEgyptTime(e){let i=new Date(e);i.setHours(i.getHours()+3);let t=new Intl.DateTimeFormat("ar-EG",{timeZone:"Africa/Cairo",weekday:"long"}).format(i),a=new Intl.DateTimeFormat("en-US",{timeZone:"Africa/Cairo",hour:"numeric",minute:"2-digit",hour12:!0}).format(i);return`${t} ${a}`}trackByOrder(e,i){return i.id}trackByRequest(e,i){return i.roomId*1e3+i.requestTypeId}trackByItem(e,i){return i.menuItemId}trackByRedemption(e,i){return i.id}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||u)(C(K),C(J),C(Z),C(z),C(Q),C(H),C(N),C(U))}}static{this.\u0275cmp=j({type:u,selectors:[["app-orders"]],standalone:!0,features:[q],decls:28,vars:14,consts:[["dir","rtl",1,"container","mx-auto","p-4"],[1,"text-2xl","font-bold","text-white","mb-4"],[1,"mb-4","grid","grid-cols-3","gap-2"],[1,"col-span-3","text-gray-400","mb-2"],[1,"relative","px-4","py-2","hover:bg-opacity-80",3,"click","ngClass"],[1,"absolute","top-0","right-3","bg-green-500","text-white","rounded-full","w-5","h-5","flex","items-center","justify-center","text-xs","transform","translate-x-1/2","-translate-y-1/2"],[1,"flex","justify-center","mb-4"],["role","group",1,"inline-flex","rounded-md","shadow-sm"],[1,"px-4","py-2","text-sm","font-medium","text-white",3,"click","ngClass"],["class","grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",4,"ngIf"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","p-4"],[1,"grid","grid-cols-1","md:grid-cols-3","lg:grid-cols-4","gap-4"],[1,"w-full","border","border-gray-700","rounded-lg","shadow-sm"],[1,"text-center","text-gray-400","p-4"],[1,"flex","border-b","border-gray-700","bg-gray-950","rounded-t-lg"],[1,"flex-1","p-4","text-sm","font-medium",3,"click","ngClass"],[1,"p-4"],[1,"space-y-2"],[1,"flex","justify-between"],[1,"font-medium","text-white"],[1,"text-gray-400"],[3,"ngClass"],[1,"mt-4","flex","justify-end","space-x-2","space-x-reverse"],[1,"px-3","py-1","bg-green-500","text-white","rounded-lg","hover:bg-green-600",3,"click"],[1,"px-3","py-1","bg-red-500","text-white","rounded-lg","hover:bg-red-600",3,"click"],[1,"space-y-4"],[1,"flex","justify-between","items-center","px-5"],[1,"text-gray-400","text-sm"],[1,"text-gray-100"],[1,"bg-gray-800","p-6","rounded-lg","w-full","max-w-sm"],[1,"text-xl","text-white","mb-4"],[1,"mb-4"],["placeholder","\u0633\u0628\u0628 \u0627\u0644\u0631\u0641\u0636",1,"w-full","px-3","py-2","border","border-gray-600","rounded-lg","bg-gray-700","text-white","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"flex","justify-end","space-x-2","space-x-reverse"],[1,"px-4","py-2","bg-gray-600","text-white","rounded-lg","hover:bg-gray-700",3,"click"],[1,"px-4","py-2","bg-red-500","text-white","rounded-lg","hover:bg-red-600",3,"click"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"h1",1),r(2," \u0627\u0644\u0637\u0644\u0628\u0627\u062A \u0648\u0637\u0644\u0628\u0627\u062A \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629 \u0648\u0637\u0644\u0628\u0627\u062A \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644 "),s(),n(3,"div",2)(4,"p",3),r(5),s(),n(6,"button",4),_("click",function(){return t.setFilter("orders")}),r(7," \u0627\u0644\u0623\u0648\u0631\u062F\u0631\u0627\u062A \u0627\u0644\u062D\u0627\u0644\u064A\u0629 "),n(8,"span",5),r(9),s()(),n(10,"button",4),_("click",function(){return t.setFilter("assistance")}),r(11," \u0637\u0644\u0628\u0627\u062A \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0629 \u0627\u0644\u062D\u0627\u0644\u064A\u0629 "),n(12,"span",5),r(13),s()(),n(14,"button",4),_("click",function(){return t.setFilter("redemptions")}),r(15," \u0637\u0644\u0628\u0627\u062A \u0627\u0644\u0627\u0633\u062A\u0628\u062F\u0627\u0644 \u0627\u0644\u062D\u0627\u0644\u064A\u0629 "),n(16,"span",5),r(17),s()()(),n(18,"div",6)(19,"div",7)(20,"button",8),_("click",function(){return t.toggleView(t.currentFilter()==="orders"?"pendingOrders":t.currentFilter()==="assistance"?"pendingAssistance":"pendingRedemptions")}),r(21," \u0645\u0639\u0644\u0642\u0629 "),s(),n(22,"button",8),_("click",function(){return t.toggleView(t.currentFilter()==="orders"?"allOrders":t.currentFilter()==="assistance"?"allAssistance":"allRedemptions")}),r(23," \u0627\u0644\u0643\u0644 "),s()()(),b(24,ae,4,1,"div",9)(25,pe,4,1,"div",9)(26,ve,4,1,"div",9)(27,fe,11,2,"div",10),s()),i&2&&(o(5),k(" \u0625\u062C\u0645\u0627\u0644\u064A: ",t.currentFilter()==="orders"?t.totalOrders():t.currentFilter()==="assistance"?t.totalAssistanceRequests():t.totalRedemptions()," ",t.currentFilter()==="orders"?"\u0637\u0644\u0628\u0627\u062A":t.currentFilter()==="assistance"?"\u0637\u0644\u0628\u0627\u062A \u0645\u0633\u0627\u0639\u062F\u0629":"\u0637\u0644\u0628\u0627\u062A \u0627\u0633\u062A\u0628\u062F\u0627\u0644"," "),o(),h("ngClass",t.currentFilter()==="orders"?"bg-gray-700 text-white":"bg-gray-950 text-white"),o(3),c(" ",t.pendingOrdersCount()," "),o(),h("ngClass",t.currentFilter()==="assistance"?"bg-gray-700 text-white":"bg-gray-950 text-white"),o(3),c(" ",t.pendingAssistanceCount()," "),o(),h("ngClass",t.currentFilter()==="redemptions"?"bg-gray-700 text-white":"bg-gray-950 text-white"),o(3),c(" ",t.pendingRedemptionsCount()," "),o(3),h("ngClass",t.currentFilter()==="orders"&&t.orderView()==="pendingOrders"||t.currentFilter()==="assistance"&&t.assistanceView()==="pendingAssistance"||t.currentFilter()==="redemptions"&&t.redemptionView()==="pendingRedemptions"?"bg-gray-700":"bg-gray-950 hover:bg-opacity-80"),o(2),h("ngClass",t.currentFilter()==="orders"&&t.orderView()==="allOrders"||t.currentFilter()==="assistance"&&t.assistanceView()==="allAssistance"||t.currentFilter()==="redemptions"&&t.redemptionView()==="allRedemptions"?"bg-gray-700":"bg-gray-950 hover:bg-opacity-80"),o(2),h("ngIf",t.currentFilter()==="orders"),o(),h("ngIf",t.currentFilter()==="assistance"),o(),h("ngIf",t.currentFilter()==="redemptions"),o(),A(27,t.showModal()?27:-1))},dependencies:[P,M,D,G,$,B,L],encapsulation:2})}}return u})();export{Me as OrdersComponent};
