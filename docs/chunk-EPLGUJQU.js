import{a as Y}from"./chunk-KTELN2TO.js";import{a as b}from"./chunk-PYGYMGSD.js";import{l as v}from"./chunk-U5OIGZK2.js";import{a as G,c as q,e as J,g as K,l as Q,n as X}from"./chunk-5LMW7FD6.js";import{$ as a,A as C,Ab as $,Ba as j,D as S,Da as l,Ea as N,G as p,Ia as s,Ja as D,Ka as L,Ma as w,N as k,Na as x,O as P,Oa as y,P as E,Q as F,Qa as m,Ra as f,Ta as V,V as O,aa as u,fb as W,ka as A,kb as B,la as I,ma as g,mb as U,sa as T,ub as R,wa as o,wb as z,xa as r,xb as H,ya as h}from"./chunk-GW44SSYG.js";var Z=(()=>{class n{constructor(t,e){this.http=t,this.authService=e,this.apiUrl=`${$.apiUrl}/settings`}createPointSetting(t,e){let i=this.authService.getStoreId();return this.http.post(`${this.apiUrl}`,{storeId:i,amount:t,points:e})}updatePointSetting(t,e,i){return this.http.put(`${this.apiUrl}`,{id:t,amount:e,points:i})}getPointSettings(){let t=this.authService.getStoreId();return this.http.get(`${this.apiUrl}/store/setting/${t}`)}static{this.\u0275fac=function(e){return new(e||n)(S(U),S(b))}}static{this.\u0275prov=C({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var tt=(()=>{class n{constructor(t,e){this.pointSettingsService=t,this.toastr=e,this.close=new O,this.amount=0,this.points=0,this.settingId=null,this.isEditing=!1}ngOnInit(){this.loadPointSettings()}loadPointSettings(){this.pointSettingsService.getPointSettings().subscribe({next:t=>{if(t.data&&t.data.length>0){let e=t.data[0];this.settingId=e.id,this.amount=e.amount,this.points=e.points,this.isEditing=!0}else this.isEditing=!1,this.amount=0,this.points=0,console.log("No point settings found, ready to create new.")},error:t=>{console.error("Failed to load point settings:",t),this.toastr.error("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637","\u062E\u0637\u0623")}})}save(){if(this.amount<=0||this.points<=0){this.toastr.error("\u0627\u0644\u0642\u064A\u0645 \u064A\u062C\u0628 \u0623\u0646 \u062A\u0643\u0648\u0646 \u0623\u0643\u0628\u0631 \u0645\u0646 \u0635\u0641\u0631","\u062E\u0637\u0623");return}this.isEditing&&this.settingId?this.pointSettingsService.updatePointSetting(this.settingId,this.amount,this.points).subscribe({next:t=>{this.toastr.success("\u062A\u0645 \u062A\u0639\u062F\u064A\u0644 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637 \u0628\u0646\u062C\u0627\u062D","\u0646\u062C\u0627\u062D"),this.closeModal()},error:t=>{console.error("Failed to update point settings:",t),this.toastr.error("\u0641\u0634\u0644 \u062A\u0639\u062F\u064A\u0644 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637","\u062E\u0637\u0623")}}):this.pointSettingsService.createPointSetting(this.amount,this.points).subscribe({next:t=>{this.toastr.success("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637 \u0628\u0646\u062C\u0627\u062D","\u0646\u062C\u0627\u062D"),this.closeModal()},error:t=>{console.error("Failed to create point settings:",t),t.status===201&&t.error.message==="\u0628\u0627\u0644\u0641\u0639\u0644 \u0644\u062F\u064A\u0643 \u0646\u0638\u0627\u0645 \u0644\u0644\u0646\u0642\u0627\u0637"?(this.toastr.error("\u0644\u062F\u064A\u0643 \u0628\u0627\u0644\u0641\u0639\u0644 \u0646\u0638\u0627\u0645 \u0646\u0642\u0627\u0637\u060C \u064A\u0645\u0643\u0646\u0643 \u062A\u0639\u062F\u064A\u0644\u0647 \u0641\u0642\u0637","\u062E\u0637\u0623"),this.loadPointSettings()):this.toastr.error("\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637","\u062E\u0637\u0623")}})}closeModal(){this.close.emit()}static{this.\u0275fac=function(e){return new(e||n)(u(Z),u(v))}}static{this.\u0275cmp=p({type:n,selectors:[["app-point-settings-modal"]],outputs:{close:"close"},standalone:!0,features:[m],decls:17,vars:4,consts:[["dir","rtl",1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-gray-800","p-6","rounded-lg","shadow-lg","w-full","max-w-sm"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"mb-4"],["for","amount",1,"block","text-gray-400","mb-2"],["id","amount","type","number","placeholder","\u0645\u062B\u0627\u0644: 1000","min","1",1,"w-full","px-3","py-2","border","border-gray-600","rounded-lg","bg-gray-700","text-white","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["for","points",1,"block","text-gray-400","mb-2"],["id","points","type","number","placeholder","\u0645\u062B\u0627\u0644: 100","min","1",1,"w-full","px-3","py-2","border","border-gray-600","rounded-lg","bg-gray-700","text-white","placeholder-gray-400","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"flex","justify-end","space-x-2","space-x-reverse"],[1,"px-4","py-2","bg-blue-500","text-white","rounded-lg","hover:bg-blue-600","transition",3,"click"],[1,"px-4","py-2","bg-gray-600","text-white","rounded-lg","hover:bg-gray-700","transition",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),s(3),r(),o(4,"div",3)(5,"label",4),s(6,"\u0627\u0644\u0645\u0628\u0644\u063A (\u062C\u0646\u064A\u0647)"),r(),o(7,"input",5),y("ngModelChange",function(d){return x(i.amount,d)||(i.amount=d),d}),r()(),o(8,"div",3)(9,"label",6),s(10,"\u0627\u0644\u0646\u0642\u0627\u0637"),r(),o(11,"input",7),y("ngModelChange",function(d){return x(i.points,d)||(i.points=d),d}),r()(),o(12,"div",8)(13,"button",9),l("click",function(){return i.save()}),s(14),r(),o(15,"button",10),l("click",function(){return i.closeModal()}),s(16," \u0625\u0644\u063A\u0627\u0621 "),r()()()()),e&2&&(a(3),D(i.isEditing?"\u062A\u0639\u062F\u064A\u0644 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637":"\u0625\u0636\u0627\u0641\u0629 \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637"),a(4),w("ngModel",i.amount),a(4),w("ngModel",i.points),a(3),L(" ",i.isEditing?"\u062A\u0639\u062F\u064A\u0644":"\u0625\u0636\u0627\u0641\u0629"," "))},dependencies:[X,G,K,q,Q,J]})}}return n})();var rt=(n,M)=>({hidden:n,block:M}),st=()=>["/owner/category"],at=()=>["/owner/orders"],ut=()=>["/owner/assistance"];function lt(n,M){if(n&1){let t=j();o(0,"app-point-settings-modal",14),l("close",function(){k(t);let i=N();return P(i.closePointSettingsModal())}),r()}}var et=(()=>{class n{constructor(t){this.authService=t,this.role=null,this.showPointSettingsModal=!1,this.isMenuOpen=!1,this.role=this.authService.getRole()}toggleMenu(){this.isMenuOpen=!this.isMenuOpen}logout(){this.authService.logout()}openPointSettingsModal(){this.showPointSettingsModal=!0}closePointSettingsModal(){this.showPointSettingsModal=!1}static{this.\u0275fac=function(e){return new(e||n)(u(b))}}static{this.\u0275cmp=p({type:n,selectors:[["app-owner-navbar"]],standalone:!0,features:[m],decls:28,vars:12,consts:[["dir","rtl",1,"bg-gray-950","text-white","fixed","top-0","w-full","z-10","shadow-md"],[1,"container","mx-auto","px-4","py-3","flex","flex-wrap","items-center","justify-between"],[1,"flex","items-center","space-x-3","space-x-reverse"],[1,"self-center","text-2xl","font-bold","whitespace-nowrap","text-white"],[1,"flex","md:order-2","gap-2"],["type","button","aria-controls","navbar-menu",1,"inline-flex","items-center","p-2","w-10","h-10","justify-center","text-sm","text-gray-300","rounded-lg","md:hidden","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-gray-600",3,"click"],[1,"sr-only"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 17 14",1,"w-5","h-5"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M1 1h15M1 7h15M1 13h15"],[1,"block","py-2","px-3","text-white","bg-red-500","hover:bg-red-600","rounded-lg","md:bg-transparent","md:hover:bg-transparent","md:hover:text-red-500","transition",3,"click"],["id","navbar-menu",1,"items-center","justify-between","w-full","md:flex","md:w-auto","md:order-1",3,"ngClass"],[1,"flex","flex-col","p-4","md:p-0","mt-4","font-medium","border","rounded-lg","md:space-x-8","md:space-x-reverse","md:flex-row","md:mt-0","md:border-0"],["routerLinkActive","!text-blue-500",1,"block","py-2","px-3","text-white","rounded-sm","hover:bg-gray-700","hover:text-blue-500","md:hover:bg-transparent","md:p-0","transition",3,"routerLink"],[1,"block","py-2","px-3","text-white","rounded-sm","hover:bg-gray-700","hover:text-blue-500","md:hover:bg-transparent","md:p-0","transition",3,"click"],[3,"close"]],template:function(e,i){e&1&&(o(0,"header",0)(1,"nav",1)(2,"a",2)(3,"span",3),s(4," Dashboard"),r()(),o(5,"div",4)(6,"button",5),l("click",function(){return i.toggleMenu()}),o(7,"span",6),s(8,"Open main menu"),r(),E(),o(9,"svg",7),h(10,"path",8),r()(),F(),o(11,"button",9),l("click",function(){return i.logout()}),s(12," \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062E\u0631\u0648\u062C "),r()(),o(13,"div",10)(14,"ul",11)(15,"li")(16,"a",12),s(17," \u0627\u0644\u0623\u0642\u0633\u0627\u0645 "),r()(),o(18,"li")(19,"a",12),s(20," \u0627\u0644\u0637\u0644\u0628\u0627\u062A "),r()(),o(21,"li")(22,"a",12),s(23," \u0627\u0644\u0645\u0633\u0627\u0639\u062F\u0627\u062A "),r()(),o(24,"li")(25,"button",13),l("click",function(){return i.openPointSettingsModal()}),s(26," \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0627\u0644\u0646\u0642\u0627\u0637 "),r()()()()()(),A(27,lt,1,0,"app-point-settings-modal")),e&2&&(a(6),I("aria-expanded",i.isMenuOpen),a(7),g("ngClass",V(6,rt,!i.isMenuOpen,i.isMenuOpen)),a(3),g("routerLink",f(9,st)),a(3),g("routerLink",f(10,at)),a(3),g("routerLink",f(11,ut)),a(5),T(27,i.showPointSettingsModal?27:-1))},dependencies:[B,W,z,H,tt],encapsulation:2})}}return n})();var kt=(()=>{class n{constructor(t,e){this.notificationService=t,this.toastr=e,this.subscription=null,this.audio=new Audio("assets/mixkit-happy-bells-notification-937.wav")}ngOnInit(){this.notificationService.startOwnerConnection().subscribe({next:()=>{this.subscription=this.notificationService.notification$.subscribe(t=>{t&&(this.toastr.info(t,"\u0625\u0634\u0639\u0627\u0631 \u062C\u062F\u064A\u062F",{disableTimeOut:!0,tapToDismiss:!0}),this.audio.play())})},error:t=>{this.toastr.error("\u0641\u0634\u0644 \u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u062E\u062F\u0645\u0629 \u0627\u0644\u0625\u0634\u0639\u0627\u0631\u0627\u062A","\u062E\u0637\u0623")}})}ngOnDestroy(){this.notificationService.stopConnection(),this.subscription&&this.subscription.unsubscribe(),this.audio.pause(),this.audio.currentTime=0}static{this.\u0275fac=function(e){return new(e||n)(u(Y),u(v))}}static{this.\u0275cmp=p({type:n,selectors:[["app-owner-dashboard"]],standalone:!0,features:[m],decls:4,vars:0,consts:[["dir","rtl"],[1,"container","mx-auto","mt-16","p-4"]],template:function(e,i){e&1&&(o(0,"div",0),h(1,"app-owner-navbar"),o(2,"main",1),h(3,"router-outlet"),r()())},dependencies:[R,et]})}}return n})();export{kt as OwnerDashboardComponent};
